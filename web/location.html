<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Location</title>

    <!-- MapTiler SDK-->
    <script src="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.umd.min.js"></script>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <link
      href="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin-top: 100px;
      }
      .container {
        background-color: #ffffff;
        color: #000;
        width: 1000px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        margin-top: 100px;
      }
      .header {
        padding: 20px;
        background-color: #f3f3f3;
        border-bottom: 1px solid #ddd;
      }
      .header h2 {
        margin: 0;
        font-size: 18px;
        color: green;
      }
      .header p {
        margin: 0;
        font-size: 14px;
        color: #666;
      }
      .map {
        height: 550px;
        width: 100%;
      }
      .dropdown {
        margin: 10px 0 10px 0;
        position: relative;
      }
      label {
        display: block;
        font-size: 14px;
        margin-top: 15px;
        color: #555;
      }
      .dropdown select {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f9f9f9;
        appearance: none;
        cursor: pointer;
        transition: border-color 0.3s;
      }
      .dropdown select:focus {
        border-color: #007bff;
        outline: none;
      }
      .dropdown::after {
        content: "â–¼";
        position: absolute;
        top: 50%;
        right: 15px;
        transform: translateY(-50%);
        pointer-events: none;
        font-size: 14px;
        color: #888;
      }
    </style>
  </head>
  <body>
    <!-- NAVBAR -->
    <div id="navbar"></div>

    <!-- Container for the map -->
    <div class="container">
      <!-- Dropdown section -->
      <label for="leafDropdown">Select Leaf Type:</label>
      <div class="dropdown">
        <select id="leafDropdown">
          <option value="">Select a leaf...</option>
          <option value="acacia">Acacia</option>
          <option value="alibangbang">Alibangbang</option>
          <option value="apitong">Apitong</option>
          <option value="asis">Asis</option>
          <option value="balayong">Balayong</option>
          <option value="balete">Balete</option>
          <option value="bayabas">Bayabas</option>
          <option value="betis">Betis</option>
          <option value="dao">Dao</option>
          <option value="dita">Dita</option>
          <option value="guyabano">Guyabano</option>
          <option value="ilang-ilang">Ilang-Ilang</option>
          <option value="ipil">Ipil</option>
          <option value="kalios">Kalios</option>
          <option value="kamagong">Kamagong</option>
          <option value="langka">Langka</option>
          <option value="mahogany">Mahogany</option>
          <option value="mangga">Mangga</option>
          <option value="mulawin">Mulawin</option>
          <option value="narra">Narra</option>
          <option value="palo-maria">Palo Maria</option>
          <option value="sintores">Sintores</option>
          <option value="yakal">Yakal</option>
        </select>
      </div>
      
      <!-- Map section -->
      <div id="map" class="map"></div>

    <!-- Navbar Section -->
    <script src="./static/script/navbar.js"></script>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Import map -->
    <script>
      // Fetch GeoJSON data
      fetch(
        "https://api.maptiler.com/data/c38a252b-0830-4793-afac-67265acd5836/features.json?key=Bnn1u1MtPCYvvZs3JJmV"
      )
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then((geojsonData) => {
          // Initialize MapTiler SDK after GeoJSON is loaded
          maptilersdk.config.apiKey = "IFhXYPDjLBHIKtmv9dba";
          const map = new maptilersdk.Map({
            container: "map",
            style: "satellite",
            center: [121.149667, 14.0772],
            zoom: 16.5,
          });

          let markers = [];

          // Function to filter markers
          function filterMarkers(leafType) {
            markers.forEach((marker) => marker.remove());
            markers = [];

            if (leafType) {
              geojsonData.features.forEach((feature) => {
                if (feature.properties.tree.includes(leafType)) {
                  const coordinates = feature.geometry.coordinates;
                  const popupContent =
                    "<h3>" + feature.properties.tree + "</h3>";

                  // Create a marker
                  const marker = new maptilersdk.Marker()
                    .setLngLat(coordinates)
                    .setPopup(new maptilersdk.Popup().setHTML(popupContent))
                    .addTo(map);

                  markers.push(marker);
                }
              });
            }
          }

          // Event listener for dropdown change
          document
            .getElementById("leafDropdown")
            .addEventListener("change", function () {
              const selectedLeaf = this.value;
              filterMarkers(selectedLeaf);
            });
        })
        .catch((error) => {
          console.error("Error fetching GeoJSON:", error);
        });
    </script>
  </body>
</html>
